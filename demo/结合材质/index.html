<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script type="text/javascript" src="../libs/three.js"></script>
    <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
    <style>
    body{
        overflow: hidden;
        margin: 0;
        padding: 0;
    }
    </style>
</head>
<body>
    <div id="stats">
    </div>
    <!-- Div which will hold the Output -->
    <div id="box">
    </div>
    
    <script type="text/javascript">
    
        let step = 0;
        function init() {
            let stats = initStats();
            let scene = new THREE.Scene();

            let camera = new THREE.PerspectiveCamera(45,window.innerWidth / window.innerHeight,10,130);
            camera.position.x = -50;
            camera.position.y = 40;
            camera.position.z = 50;
            camera.near = 7;
            camera.far = 139;
            camera.lookAt(scene.position);

            let renderer = new THREE.WebGLRenderer();
            renderer.setClearColor(new THREE.Color(0x00000,1.0));
            renderer.setSize(window.innerWidth,window.innerHeight);
            renderer.shadowMapEnabled = true;

            let oBox = document.getElementById('box');
            oBox.appendChild(renderer.domElement);


            let controls = new function() {
                this.cameraNear = camera.near;
                this.cameraFar = camera.far;
                this.rotationSpeed = 0.02;
                this.numberOfObjects = scene.children.length;
                this.color = 0x00ff00;
                this.removeCube = function() {
                    let allChildren = scene.children;
                    let lastObject = allChildren[allChildren.length -1];
                    if(lastObject instanceof THREE.Mesh) {
                        scene.remove(lastObject);
                        this.numberOfObjects = scene.children.length;
                    }
                }
                this.addCube = function () {
                    let cubeSize = Math.ceil(3 + (Math.random() * 3));
                    let cubeGeometry = new THREE.BoxGeometry(cubeSize,cubeSize,cubeSize);
                    let cubeMaterial = new THREE.MeshDepthMaterial();
                    let colorMaterial = new THREE.MeshBasicMaterial({
                        color:controls.color,
                        transparent:true,
                        blending:THREE.MultiplyBlending
                    });
                    let cube = new THREE.SceneUtils.createMultiMaterialObject(cubeGeometry,[colorMaterial,cubeMaterial]);
                    cube.children[1].scale.set(0.99,0.99,0.99);
                    cube.castShadow = true;
                    cube.position.x = -60 + Math.round(Math.random() * 100);
                    cube.position.y = Math.round((Math.random() * 10));
                    cube.position.z = -100 + Math.round((Math.random() * 150));
                    scene.add(cube);
                    this.numberOfObjects = scene.children.length;
        
                }
                this.outputObjects = function() {
                    console.log(scene.children);
                }
            }

            let gui = new dat.GUI();
            gui.addColor(controls,'color');
            gui.add(controls,'rotationSpeed',0,0.5);
            gui.add(controls,'addCube');
            gui.add(controls,'removeCube');
            gui.add(controls,'cameraNear',0,50).onChange(function(e){
                camera.near = e;

            })
            gui.add(controls,'cameraFar',50,200).onChange(function(e) {
                camera.far = e;
            })

            let i = 0;
            while(i < 10) {
                controls.addCube();
                i++;
            }
    
            render();
            function render() {
                stats.update();
                scene.traverse(function(e) {
                    if(e instanceof THREE.Mesh) {
                        e.rotation.x += controls.rotationSpeed;
                        e.rotation.y += controls.rotationSpeed;
                        e.rotation.z += controls.rotationSpeed;
                    }
                })
                requestAnimationFrame(render);
                renderer.render(scene,camera);
            }

            function initStats() {
                let stats = new Stats();
                stats.setMode(0);
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.left = '0px';
                stats.domElement.style.top = '0px';
                let oStats = document.getElementById('stats');
                oStats.appendChild(stats.domElement);
                return stats;
            }
        }
        window.onload = init;
    </script>
</body>
</html>